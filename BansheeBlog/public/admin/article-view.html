<script type="text/template" data-template id="article-view" >
    <div class="flex two three-500">
        <div>
            <span>Articles</span>
            <ul data-bindings="articles -> innerHTML, articlesClicked -> onclick"></ul>
        </div>
        <div>
            <label>Preview</label>
            <div data-bindings="html -> innerHTML" class="preview" id="new-article-preview"></div>
        </div>
    </div>
</script>

<script type="text/javascript" data-behaviour for="article-view">
    function onBind() {
        return {
            afterBind: async () => {
                const articles = await request("GET", "/admin/articles");
                this.articleCache = Object.create(null);
                this.articles = articles.map(article => {
                    this.articleCache[article.Slug] = article;
                    return `<li class="pseudo button" data-slug='${article.Slug}'>${article.Title}</li>`;
                }).join("");
            },
            properties: {
                articlesClicked: event => {
                    if (!event.target.matches("li[data-slug]")) {
                        return;
                    }
                    const article = this.articleCache[event.target.dataset.slug];
                    const bindingContext = {
                        title: article.Title,
                        slug: article.Slug,
                        markdown: article.Markdown,
                        html: article.Html,
                        tags: article.Tags.join(" "),
                        public: article.Public,
                    };
                    console.log(bindingContext);
                    dataBinder.render('article-editor', 'content', bindingContext);
                }
            }
        };
    }
</script>