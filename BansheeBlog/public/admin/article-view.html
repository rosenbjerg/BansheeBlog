<script type="text/template" data-template id="article-view" >
    <div style="margin: 0 auto; max-width: 800px">
        <span>Articles</span>
        <ul id="article-list"></ul>
    </div>
</script>

<script type="text/javascript" data-behaviour for="article-view">
    function onBind() {
        return {
            afterBind: async () => {
                const createElement = (tag, cls, html) => {
                    const element = document.createElement(tag);
                    element.className = cls;
                    if (html) element.innerHTML = html;
                    return element;
                };

                const editArticle = article => {
                    request("GET", `/admin/article/${article.Id}/markdown`).then(markdown => {
                        const bindingContext = {
                            id: article.Id,
                            title: article.Title,
                            slug: article.Slug,
                            markdown: markdown.Content,
                            tags: article.Tags.split(",").join(" "),
                            public: article.Public
                        };
                        dataBinder.render('article-editor', 'content', bindingContext);
                    });
                };
                const deleteArticle = article => {

                };

                const articleList = document.getElementById("article-list");
                
                const articles = await request("GET", "/admin/articles");
                
                for (const article of articles) {
                    const articleElement = createElement("li", "article-item", article.Title);
                    const deleteButton = createElement("i", "material-icons", "delete");
                    const editButton = createElement("i", "material-icons", "create");
                    const publicButton = createElement("i", "material-icons toggled-off", "public");
                    
                    deleteButton.onclick = () => deleteArticle(article);
                    editButton.onclick = () => editArticle(article);
                    publicButton.onclick = () => {
                        article.Public = !article.Public;
                        request("PUT", "/admin/article", article).then(() => {
                            if (article.Public) {
                                publicButton.classList.remove("toggled-off");
                            }
                            else {
                                publicButton.classList.add("toggled-off");
                            }
                        })
                        
                    };
                    
                    
                    articleElement.appendChild(deleteButton);
                    articleElement.appendChild(editButton);
                    articleElement.appendChild(publicButton);
                    articleList.appendChild(articleElement);
                }
            }
        };
    }
</script>